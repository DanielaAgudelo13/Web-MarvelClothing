{"mappings":"oeAAA,IAAAA,EAAAC,EAAA,sBCAAC,EAAAD,EAAA,uCDMA,MAAME,EAAiBC,SAASC,cAAc,YACxCC,EAAiBF,SAASG,eAAe,YACzCC,EAAcJ,SAASG,eAAe,SAI5C,IAAIE,EAFJC,QAAQC,IAAIR,GAGZ,IAAIS,EAAW,GACXC,EAAO,GAEXC,eAAeC,IACX,MAAMC,QCfVF,eAA2BG,GACvB,MAAMC,EAAgBhB,EAAAiB,WAAWF,EAAI,YACrC,IACI,MALRG,KAKgBA,SAAelB,EAAAmB,QAAQH,GACzBI,EAAWF,EAAKG,KAAKC,IAChB,IACAA,EAAIC,OACPC,GAAIF,EAAIE,OAIhB,OADAhB,QAAQC,MACDW,EACT,MAAOK,GACLjB,QAAQC,IAAIgB,IDEeC,CAAY5B,EAAAiB,IAC3Cd,EAAe0B,UAAY,GAC3Bb,EAAiBc,SAASC,IACtBC,EAAcD,MAGlBnB,EAAWI,EAGf,SAASgB,EAAcC,GACnB,MAAMF,EAAU3B,SAAS8B,cAAc,KACvCH,EAAQI,UAAY,UAEpBJ,EAAQK,aAAa,OAAQ,qBAAqBH,EAAKP,MAEvD,MAAMW,EAAaJ,EAAKK,OAClBL,EAAKK,OAAO,GACZ,8EAEAC,EAAiBN,EAAKK,OAAO,GAM7BE,EAJuB3B,EAAK4B,MAC7BC,GAAgBA,EAAYhB,KAAOO,EAAKP,KAIvC,mEAAkE,2DAGvEK,EAAOF,UAAY,kGAsBFQ,qFAGdE,uIASDN,EAAAU,6BACNV,EAAAW,0DAEgBX,EAAGY,0BACVL,sCAO+CrC,EAC/C2C,YAAAf,SAEFgB,EAAmBhB,EAAA1B,cAAA,kBAGvB0C,EAAiBC,iBACb,SAAmBlC,MAAAa,IAAmDA,EAAAsB,iBAGtEpC,EACAqC,KAAAjB,GAAsEkB,EAAAC,iBAAAvC,GAG1EJ,SAAwB4C,EAAMC,mBAAAtD,EAAAiB,GAAAR,EAAA8C,IAAA1C,GAC9BkC,EAAiBX,aAAgB,YAAK,GAClCW,EAAAS,UAAA,sBAIR,SAAAC,IACI,MAAAC,EAAApD,EAAWqD,MACZC,EAAApD,EAAAmD,MAEH,IAAAE,EAAA,GACIA,EAAA,KAAAH,EAAW9C,EAAAkD,QAAA/B,GAAAA,EAAAgC,WAAAL,IAGf9C,EACc,QAANgD,IAAMC,EAAAA,EAAAG,MAAA,CAAAC,EAAAC,IAAAA,EAAArB,MAAAoB,EAAApB,SAEN,SAAAe,IAAAC,EAAAA,EAAAG,MAA8D,CAAAC,EAAAC,IAAAD,EAAApB,MAAAqB,EAAArB,WAEvDhB,UAAM,GACbgC,EAAM/B,SAAAC,IACTC,EACUD","sources":["js/shop.js","js/products.js"],"sourcesContent":["import { db, auth } from \"./app\";\r\nimport { onAuthStateChanged } from \"firebase/auth\";\r\nimport { getProducts } from \"./products\";\r\nimport { createFirebaseCart, getFirebaseCart } from \"./cart\";\r\nimport { addProductToCart, getMyLocalCart, currencyFormat } from \"./utils\";\r\n\r\nconst productSection = document.querySelector(\".product\");\r\nconst categoryFilter = document.getElementById(\"category\");\r\nconst orderFilter = document.getElementById(\"order\");\r\n\r\nconsole.log(productSection);\r\n\r\nlet userLogged = undefined;\r\nlet products = [];\r\nlet cart = [];\r\n\r\nasync function loadProducts() {\r\n    const firebaseProducts = await getProducts(db);\r\n    productSection.innerHTML = \"\";\r\n    firebaseProducts.forEach((product) => {\r\n        renderProduct(product);\r\n    });\r\n\r\n    products = firebaseProducts;\r\n}\r\n\r\nfunction renderProduct(item) {\r\n    const product = document.createElement(\"a\");\r\n    product.className = \"product\";\r\n\r\n    product.setAttribute(\"href\", `./product.html?id=${item.id}`);\r\n\r\n    const coverImage = item.images\r\n        ? item.images[0]\r\n        : \"https://cdn1.iconfinder.com/data/icons/business-company-1/500/image-512.png\";\r\n\r\n    const secondaryImage = item.images[1];\r\n\r\n    const isProductAddedToCart = cart.some(\r\n        (productCart) => productCart.id === item.id\r\n    );\r\n\r\n    const productButtonCart = isProductAddedToCart\r\n        ? '<button class=\"product__cart\" disabled>Producto añadido</button>'\r\n        : '<button class=\"product__cart\">Añadir al carrito</button>';\r\n\r\n    product.innerHTML = `\r\n    <div class=\"product__item\">\r\n        <div class=\"product__image\">\r\n            <img src=\"${coverImage}\"\r\n                alt=\"\" class=\"product__image--main\" />\r\n            <img src=\"${secondaryImage}\"\r\n                alt=\"\" class=\"product__image--hover\" />\r\n        </div>\r\n\r\n        <div class=\"product__info\">\r\n            <h2>${item.name}</h2>\r\n            <p>${item.description}</p>\r\n            <p class=\"product__price\">${item.price}</p>\r\n            ${productButtonCart}\r\n        </div>\r\n    </div>\r\n    `;\r\n\r\n    productSection.appendChild(product);\r\n\r\n    const productCartButton = product.querySelector(\".product__cart\");\r\n\r\n    productCartButton.addEventListener(\"click\", async (e) => {\r\n        e.preventDefault(); // evitar que al dar click en el boton, funcione el enlace del padre.\r\n\r\n        cart.push(item);\r\n        addProductToCart(cart);\r\n\r\n        if (userLogged) {\r\n            await createFirebaseCart(db, userLogged.uid, cart);\r\n        }\r\n\r\n        productCartButton.setAttribute(\"disabled\", true);\r\n        productCartButton.innerText = \"Producto añadido\";\r\n    });\r\n}\r\n\r\nfunction filterBy() {\r\n    const newCategory = categoryFilter.value;\r\n    const newOrder = orderFilter.value;\r\n\r\n    let filteredProducts = [];\r\n\r\n    if (newCategory !== \"\") {\r\n        filteredProducts = products.filter(\r\n            (product) => product.category === newCategory\r\n        );\r\n    } else {\r\n        filteredProducts = products;\r\n    }\r\n\r\n    if (newOrder === \"asc\") {\r\n        filteredProducts = filteredProducts.sort((a, b) => b.price - a.price);\r\n    }\r\n\r\n    if (newOrder === \"desc\") {\r\n        filteredProducts = filteredProducts.sort((a, b) => a.price - b.price);\r\n    }\r\n\r\n    productSection.innerHTML = \"\";\r\n    filteredProducts.forEach((product) => {\r\n        renderProduct(product);\r\n    });\r\n}\r\n\r\ncategoryFilter.addEventListener(\"change\", (e) => {\r\n    filterBy();\r\n});\r\n\r\norderFilter.addEventListener(\"change\", (e) => {\r\n    filterBy();\r\n});\r\n\r\nonAuthStateChanged(auth, async (user) => {\r\n    if (user) {\r\n        // User is signed in, see docs for a list of available properties\r\n        // https://firebase.google.com/docs/reference/js/firebase.User\r\n        userLogged = user;\r\n        cart = await getFirebaseCart(db, userLogged.uid);\r\n        // ...\r\n    } else {\r\n        cart = getMyLocalCart();\r\n        // User is signed out\r\n        // ...\r\n    }\r\n\r\n    loadProducts();\r\n});\r\n","import { collection, getDocs } from \"firebase/firestore\";\r\n\r\nasync function getProducts(db) {\r\n    const collectionRef = collection(db, \"products\");\r\n    try {\r\n        const { docs } = await getDocs(collectionRef);\r\n        const products = docs.map((doc) => {\r\n            return {\r\n                ...doc.data(),\r\n                id: doc.id,\r\n            };\r\n        });\r\n        console.log();\r\n        return products;\r\n    } catch (e) {\r\n        console.log(e);\r\n    }\r\n}\r\n\r\nexport { getProducts };\r\n"],"names":["$6QD2Y","parcelRequire","$etBjH","$1ddef344fc51d0a0$var$productSection","document","querySelector","$1ddef344fc51d0a0$var$categoryFilter","getElementById","$1ddef344fc51d0a0$var$orderFilter","$1ddef344fc51d0a0$var$userLogged","console","log","$1ddef344fc51d0a0$var$products","$1ddef344fc51d0a0$var$cart","async","$1ddef344fc51d0a0$var$loadProducts","firebaseProducts","db","collectionRef","collection","docs","getDocs","products","map","doc","data","id","e","$da1ec6fc722d617e$export$68a801b7b3c0bfaa","innerHTML","forEach","product","$1ddef344fc51d0a0$var$renderProduct","item","createElement","className","setAttribute","coverImage","images","secondaryImage","productButtonCart","some","productCart","name","description","price","appendChild","productCartButton","addEventListener","preventDefault","push","$LMLC2","addProductToCart","$hAAYD","createFirebaseCart","uid","innerText","$1ddef344fc51d0a0$var$filterBy","newCategory","value","newOrder","filteredProducts","filter","category","sort","a","b"],"version":3,"file":"shop.db094f81.js.map"}